{"title":"使用SIMH模拟器安装4.2 BSD（以Win11为例）","date":"2023-05-08T12:50:09.362Z","date_formatted":{"ll":"May 8, 2023","L":"05/08/2023","MM-DD":"05-08"},"link":"2023/win10_4.2_BSD","comments":true,"tags":["4.2 BSD","SIMH","roguelike","教程","虚拟机","资源"],"updated":"2023-04-25T14:01:30.000Z","content":"<p>最近在<a href=\"roguelike/\">Archive RL S</a>写Moria的时候非常想玩一下VMS上的原版Moria，拿SIMH折腾了很久没成功（能启动VMS 2.0，但是无法在宿主机和虚拟机之间传输文件）。卡住期间顺手试了试<a href=\"https://gunkies.org/wiki/Installing_4.2_BSD_on_SIMH\" target=\"_blank\">别的教程</a>，成功在SIMH的VAX-11/780虚拟机上启动了自带Rogue 5.3的4.2 BSD系统（让Rogue在1980年代风靡全美大学生的功臣之一）。在这里复述一下教程并记录安装经过。</p>\n<h2 id=\"文件需求\">文件需求<a title=\"#文件需求\" href=\"#文件需求\"></a></h2>\n<p>为了安装4.2 BSD，你需要准备以下文件：（所有下载文件的<a href=\"files/rl/rogue/4.2bsd_pack.zip\">zip包</a>，省得一个一个点链接）</p>\n<ul>\n<li>Perl解释器，用来制作4.2 BSD的磁带镜像；</li>\n<li>gzip（或者随便什么可以解压.tar.gz文件的解压工具，我用的是Bandizip）；</li>\n<li>boot42文件，使用Linux的uudecode命令从<a href=\"files/rl/rogue/4.2BSD/boot42.uue\">boot42.uue</a>文件中解码，或下载解码好的文件（<a href=\"https://sourceforge.net/projects/bsd42/files/Install%20tapes/4.2%20BSD/boot42/download\" target=\"_blank\">sourceforge</a>/<a href=\"files/rl/rogue/4.2BSD/boot42\">本地镜像</a>）；</li>\n<li>编译好的SIMH <a href=\"files/rl/rogue/4.2BSD/VAX780.exe\">vax780.exe</a>，以及SIMH <a href=\"files/rl/rogue/4.2BSD/vmb.exe\">vmb.exe</a>（不过vmb.exe全程好像都没用到？不知道有什么用……）。你也可以在<a href=\"https://github.com/simh/simh\" target=\"_blank\">SIMH官方repo</a>下载自动编译的版本（vmb.exe在<a href=\"https://github.com/simh/simh/tree/master/VAX\" target=\"_blank\">src里</a>，最新编译的vax780.exe文件在<a href=\"https://github.com/simh/simh/actions\" target=\"_blank\">Actions</a>中任意一个run里的Artifacts里）；</li>\n</ul>\n<p>也可以直接下载<a href=\"files/rl/rogue/4.2BSD/4.2bsd.tap.bz2\">制作好的4.2 BSD磁带镜像</a>，需要bzip2（或者随便什么可以解压.bz2文件的解压工具，Bandizip仍然适用）。</p>\n<p>此外，你还需要以下4.2 BSD的目录文件（教程作者建议从<a href=\"http://tuhs.superglobalmegacorp.com/4BSD/Distributions/4.2BSD/\" target=\"_blank\">tuhs.superglobalmegacorp.com</a>下载，但是这个站点目前似乎挂了，我用了时光机才下下来，非常折腾……建议直接用上面那个全套zip包）：</p>\n<p><a href=\"http://tuhs.superglobalmegacorp.com/4BSD/Distributions/4.2BSD/ingres.tar.gz\" target=\"_blank\">ingres.tar.gz</a><br>\n<a href=\"http://tuhs.superglobalmegacorp.com/4BSD/Distributions/4.2BSD/miniroot.gz\" target=\"_blank\">miniroot.gz</a><br>\n<a href=\"http://tuhs.superglobalmegacorp.com/4BSD/Distributions/4.2BSD/new.tar.gz\" target=\"_blank\">new.tar.gz</a><br>\n<a href=\"http://tuhs.superglobalmegacorp.com/4BSD/Distributions/4.2BSD/rootdump.gz\" target=\"_blank\">rootdump.gz</a><br>\n<a href=\"http://tuhs.superglobalmegacorp.com/4BSD/Distributions/4.2BSD/src.tar.gz\" target=\"_blank\">src.tar.gz</a><br>\n<a href=\"http://tuhs.superglobalmegacorp.com/4BSD/Distributions/4.2BSD/srcsys.tar.gz\" target=\"_blank\">srcsys.tar.gz</a><br>\n<a href=\"http://tuhs.superglobalmegacorp.com/4BSD/Distributions/4.2BSD/stand.gz\" target=\"_blank\">stand.gz</a><br>\n<a href=\"http://tuhs.superglobalmegacorp.com/4BSD/Distributions/4.2BSD/usr.tar.gz\" target=\"_blank\">usr.tar.gz</a><br>\n<a href=\"http://tuhs.superglobalmegacorp.com/4BSD/Distributions/4.2BSD/vfont.tar.gz\" target=\"_blank\">vfont.tar.gz</a></p>\n<h2 id=\"安装准备\">安装准备<a title=\"#安装准备\" href=\"#安装准备\"></a></h2>\n<h3 id=\"准备4.2-bsd磁带镜像（42.tap）\">准备4.2 BSD磁带镜像（42.tap）<a title=\"#准备4.2-bsd磁带镜像（42.tap）\" href=\"#准备4.2-bsd磁带镜像（42.tap）\"></a></h3>\n<p><strong>如果你安装了Perl解释器，打算自己制作4.2 BSD镜像：</strong></p>\n<p>首先解压所有用来制作镜像的文件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gzip -d *.gz</span><br></pre></td></tr></table></figure>\n<p>接着命令行运行<a href=\"files/rl/rogue/4.2BSD/mkdisttap.pl\">mkdisttap.pl</a>，将输出导入42.tap文件（教程提供的是Linux命令行示例，我自己运行脚本报错找不到stand，所以用的是制作好的镜像）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">% ./mkdisttap.pl &gt; 42.tap</span><br><span class=\"line\">% ls -l 42.tap</span><br><span class=\"line\">-rw-r--r--  1 Neozeed  +SYSTEM  69943640 Feb  6 12:39 42.tap</span><br></pre></td></tr></table></figure>\n<p><strong>如果你选择信任预编译，直接使用做好的4.2 BSD镜像：</strong></p>\n<p>解压4.2bsd.tap.bz2，然后将文件名改为42.tap即可。</p>\n<h3 id=\"准备启动程序（boot42）\">准备启动程序（boot42）<a title=\"#准备启动程序（boot42）\" href=\"#准备启动程序（boot42）\"></a></h3>\n<p>解码boot42.uue文件，如果你使用解码后的boot42请无视这一步：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">% ls -l boot42.uue</span><br><span class=\"line\">-rw-r--r--  1 Neozeed  None_ploc  9117 Feb  6 12:09 boot42.uue</span><br><span class=\"line\">% uudecode boot42.uue</span><br><span class=\"line\">% ls -l boot42</span><br><span class=\"line\">-rw-------  1 Neozeed  None_ploc  6600 Feb  6 12:28 boot42</span><br><span class=\"line\">% file boot42</span><br><span class=\"line\">boot42: data</span><br></pre></td></tr></table></figure>\n<h2 id=\"第一阶段\">第一阶段<a title=\"#第一阶段\" href=\"#第一阶段\"></a></h2>\n<p>在安装的第一阶段，我们需使用如下的 <strong>install.ini</strong> 配置文件（复制到文本文档后重命名为install.ini，也可以<a href=\"files/rl/rogue/4.2BSD/install.ini\">直接下载</a>）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set rq0 ra81</span><br><span class=\"line\">at rq0 miniroot</span><br><span class=\"line\">set rq1 ra81</span><br><span class=\"line\">at rq1 rq.dsk</span><br><span class=\"line\">set rq1 dis</span><br><span class=\"line\">set rq2 dis</span><br><span class=\"line\">set rq3 dis</span><br><span class=\"line\">set rp dis</span><br><span class=\"line\">set lpt dis</span><br><span class=\"line\">set rl dis</span><br><span class=\"line\">set tq dis</span><br><span class=\"line\">set tu dis</span><br><span class=\"line\">att ts 42.tap</span><br><span class=\"line\">set tti 7b</span><br><span class=\"line\">set tto 7b</span><br><span class=\"line\">load -o boot42 0</span><br><span class=\"line\">d r10 9</span><br><span class=\"line\">d r11 0</span><br><span class=\"line\">run 2</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动虚拟机\">启动虚拟机<a title=\"#启动虚拟机\" href=\"#启动虚拟机\"></a></h3>\n<p>使用 <strong>install.ini</strong> 启动我们的vax780.exe虚拟机。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\4.2BSD\\work&gt;vax780 install.ini</span><br><span class=\"line\"></span><br><span class=\"line\">VAX780 simulator V3.8-0</span><br><span class=\"line\">RQ: creating new file</span><br><span class=\"line\">1.txt&gt; set rq1 dis</span><br><span class=\"line\">Command not allowed</span><br><span class=\"line\">loading ra(0,0)boot</span><br><span class=\"line\">Boot</span><br><span class=\"line\">: ra(0,0)vmunix</span><br><span class=\"line\">199488+56036+51360 start 0x11a0</span><br><span class=\"line\">4.2 BSD UNIX #9: Wed Nov 2 16:00:29 PST 1983</span><br><span class=\"line\">real mem  = 8384512</span><br><span class=\"line\">avail mem = 7073792</span><br><span class=\"line\">using 102 buffers containing 835584 bytes of memory</span><br><span class=\"line\">mcr0 at tr1</span><br><span class=\"line\">mcr1 at tr2</span><br><span class=\"line\">uba0 at tr3</span><br><span class=\"line\">hk0 at uba0 csr 177440 vec 210, ipl 15</span><br><span class=\"line\">rk0 at hk0 slave 0</span><br><span class=\"line\">rk1 at hk0 slave 1</span><br><span class=\"line\">uda0 at uba0 csr 172150 vec 774, ipl 15</span><br><span class=\"line\">ra0 at uda0 slave 0</span><br><span class=\"line\">ra1 at uda0 slave 1</span><br><span class=\"line\">zs0 at uba0 csr 172520 vec 224, ipl 15</span><br><span class=\"line\">ts0 at zs0 slave 0</span><br><span class=\"line\">dz0 at uba0 csr 160100 vec 300, ipl 15</span><br><span class=\"line\">dz1 at uba0 csr 160110 vec 310, ipl 15</span><br><span class=\"line\">dz2 at uba0 csr 160120 vec 320, ipl 15</span><br><span class=\"line\">dz3 at uba0 csr 160130 vec 330, ipl 15</span><br><span class=\"line\">root on ra0</span><br><span class=\"line\">WARNING: clock gained 94 days -- CHECK AND RESET THE DATE!</span><br><span class=\"line\">WARNING: should run interleaved swap with &gt;= 2Mb</span><br><span class=\"line\">erase ^?, kill ^U, intr ^C</span><br><span class=\"line\">#</span><br></pre></td></tr></table></figure>\n<h3 id=\"恢复rootdump\">恢复rootdump<a title=\"#恢复rootdump\" href=\"#恢复rootdump\"></a></h3>\n<p>现在我们正在rq0磁盘上的miniroot上运行。为了将系统从磁带镜像安装到虚拟机的磁盘上，我们需要运行磁带中的xtr程序以恢复rootdump（知识水平不足，这部分不太理解）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd /dev</span><br><span class=\"line\"># ./MAKEDEV ra1</span><br><span class=\"line\"># cd /</span><br><span class=\"line\"># disk=ra1 type=ra81 tape=ts xtr</span><br></pre></td></tr></table></figure>\n<p>执行结果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">erase ^?, kill ^U, intr ^C</span><br><span class=\"line\"># cd /dev</span><br><span class=\"line\"># ./MAKEDEV ra1</span><br><span class=\"line\"># cd /</span><br><span class=\"line\"># disk=ra1 type=ra81 tape=ts xtr</span><br><span class=\"line\">Build root file system</span><br><span class=\"line\">Warning: 538 sector(s) in last cylinder unallocated</span><br><span class=\"line\">/dev/rra1a:     15884 sectors in 23 cylinders of 14 tracks, 51 se</span><br><span class=\"line\">        8.1Mb in 2 cyl groups (16 c/g, 5.85Mb/g, 1856 i/g)</span><br><span class=\"line\">super-block backups (for fsck -b#) at:</span><br><span class=\"line\"> 32, 11520,</span><br><span class=\"line\">Check the file system</span><br><span class=\"line\">** /dev/rra1a</span><br><span class=\"line\">** Last Mounted on</span><br><span class=\"line\">** Phase 1 - Check Blocks and Sizes</span><br><span class=\"line\">** Phase 2 - Check Pathnames</span><br><span class=\"line\">** Phase 3 - Check Connectivity</span><br><span class=\"line\">** Phase 4 - Check Reference Counts</span><br><span class=\"line\">** Phase 5 - Check Cyl groups</span><br><span class=\"line\">2 files, 9 used, 7420 free (20 frags, 925 blocks)</span><br><span class=\"line\">Rewind tape</span><br><span class=\"line\">Restore the dump image of the root</span><br><span class=\"line\">Warning: ./lost+found: File exists</span><br><span class=\"line\">** /dev/rra1a</span><br><span class=\"line\">** Last Mounted on /a</span><br><span class=\"line\">** Phase 1 - Check Blocks and Sizes</span><br><span class=\"line\">** Phase 2 - Check Pathnames</span><br><span class=\"line\">** Phase 3 - Check Connectivity</span><br><span class=\"line\">** Phase 4 - Check Reference Counts</span><br><span class=\"line\">** Phase 5 - Check Cyl groups</span><br><span class=\"line\">313 files, 3568 used, 3861 free (21 frags, 480 blocks)</span><br><span class=\"line\">Root filesystem extracted</span><br><span class=\"line\"></span><br><span class=\"line\">If this is a 780, update floppy</span><br><span class=\"line\">If this is a 730, update the cassette</span><br><span class=\"line\">#</span><br></pre></td></tr></table></figure>\n<p>在此之后，执行几次sync以保证数据同步写入磁盘（是这样吗？），然后按CTRL+E退出虚拟机并关闭simh：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">If this is a 730, update the cassette</span><br><span class=\"line\"># sync</span><br><span class=\"line\"># sync</span><br><span class=\"line\"># sync</span><br><span class=\"line\"></span><br><span class=\"line\">Simulation stopped, PC: 80001620 (FFS #0,#20,8003ED44,R0)</span><br><span class=\"line\">sim&gt; q</span><br><span class=\"line\">Goodbye</span><br><span class=\"line\"></span><br><span class=\"line\">C:\\4.2BSD\\work&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"第二阶段\">第二阶段<a title=\"#第二阶段\" href=\"#第二阶段\"></a></h2>\n<p>现在系统磁盘已经准备好了，我们可以使用一个新的配置文件 <strong>boot.ini</strong> 来启动虚拟机。（也可以<a href=\"files/rl/rogue/4.2BSD/boot.ini\">直接下载</a>）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set rq0 ra81</span><br><span class=\"line\">att rq0 rq.dsk</span><br><span class=\"line\">set rq1 dis</span><br><span class=\"line\">set rq2 dis</span><br><span class=\"line\">set rq3 dis</span><br><span class=\"line\">set rp dis</span><br><span class=\"line\">set lpt dis</span><br><span class=\"line\">set rl dis</span><br><span class=\"line\">set tq dis</span><br><span class=\"line\">set tu dis</span><br><span class=\"line\">att ts 42.tap</span><br><span class=\"line\">set tti 7b</span><br><span class=\"line\">set tto 7b</span><br><span class=\"line\">load -o boot42 0</span><br><span class=\"line\">d r10 9</span><br><span class=\"line\">d r11 0</span><br><span class=\"line\">run 2</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动虚拟机-1\">启动虚拟机<a title=\"#启动虚拟机-1\" href=\"#启动虚拟机-1\"></a></h3>\n<p>使用 <strong>boot.ini</strong> 启动虚拟机：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\4.2BSD\\work&gt;vax780.exe boot.ini</span><br><span class=\"line\"></span><br><span class=\"line\">VAX780 simulator V3.8-0</span><br><span class=\"line\">TS: creating new file</span><br><span class=\"line\">loading ra(0,0)boot</span><br><span class=\"line\">Boot</span><br><span class=\"line\">: ra(0,0)vmunix</span><br><span class=\"line\">199488+56036+51360 start 0x11a0</span><br><span class=\"line\">4.2 BSD UNIX #9: Wed Nov 2 16:00:29 PST 1983</span><br><span class=\"line\">real mem  = 8384512</span><br><span class=\"line\">avail mem = 7073792</span><br><span class=\"line\">using 102 buffers containing 835584 bytes of memory</span><br><span class=\"line\">mcr0 at tr1</span><br><span class=\"line\">mcr1 at tr2</span><br><span class=\"line\">uba0 at tr3</span><br><span class=\"line\">hk0 at uba0 csr 177440 vec 210, ipl 15</span><br><span class=\"line\">rk0 at hk0 slave 0</span><br><span class=\"line\">rk1 at hk0 slave 1</span><br><span class=\"line\">uda0 at uba0 csr 172150 vec 774, ipl 15</span><br><span class=\"line\">ra0 at uda0 slave 0</span><br><span class=\"line\">ra1 at uda0 slave 1</span><br><span class=\"line\">zs0 at uba0 csr 172520 vec 224, ipl 15</span><br><span class=\"line\">ts0 at zs0 slave 0</span><br><span class=\"line\">dz0 at uba0 csr 160100 vec 300, ipl 15</span><br><span class=\"line\">dz1 at uba0 csr 160110 vec 310, ipl 15</span><br><span class=\"line\">dz2 at uba0 csr 160120 vec 320, ipl 15</span><br><span class=\"line\">dz3 at uba0 csr 160130 vec 330, ipl 15</span><br><span class=\"line\">root on ra0</span><br><span class=\"line\">WARNING: should run interleaved swap with &gt;= 2Mb</span><br><span class=\"line\">Automatic reboot in progress...</span><br><span class=\"line\">Mon Feb  6 05:05:49 PST 1984</span><br><span class=\"line\">Can&#x27;t open checklist file: /etc/fstab</span><br><span class=\"line\">Automatic reboot failed... help!</span><br><span class=\"line\">erase ^?, kill ^U, intr ^C</span><br><span class=\"line\">#</span><br></pre></td></tr></table></figure>\n<h3 id=\"准备磁盘\">准备磁盘<a title=\"#准备磁盘\" href=\"#准备磁盘\"></a></h3>\n<p>配置硬件设备（这里也不太明白）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># disk=ra</span><br><span class=\"line\"># name=ra0h;type=ra81</span><br><span class=\"line\"># cd /dev</span><br><span class=\"line\"># ./MAKEDEV ts0;sync</span><br><span class=\"line\"># cd /</span><br><span class=\"line\"># newfs $name $type</span><br></pre></td></tr></table></figure>\n<p>执行结果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># disk=ra</span><br><span class=\"line\"># name=ra0h;type=ra81</span><br><span class=\"line\"># cd /dev</span><br><span class=\"line\"># ./MAKEDEV ts0;sync</span><br><span class=\"line\"># cd /</span><br><span class=\"line\"># newfs $name $type</span><br><span class=\"line\">Warning: 28 sector(s) in last cylinder unallocated</span><br><span class=\"line\">/dev/rra0h:     759668 sectors in 1064 cylinders of 14 tracks, 51 sectors</span><br><span class=\"line\">        389.0Mb in 67 cyl groups (16 c/g, 5.85Mb/g, 2048 i/g)</span><br><span class=\"line\">super-block backups (for fsck -b#) at:</span><br><span class=\"line\"> 32, 11512, 22992, 34472, 45952, 57432, 68912, 80392, 91872, 103352,</span><br><span class=\"line\"> 114832, 126312, 137792, 149272, 160752, 172232, 182816, 194296, 205776, 217256,</span><br><span class=\"line\"> 228736, 240216, 251696, 263176, 274656, 286136, 297616, 309096, 320576, 332056,</span><br><span class=\"line\"> 343536, 355016, 365600, 377080, 388560, 400040, 411520, 423000, 434480, 445960,</span><br><span class=\"line\"> 457440, 468920, 480400, 491880, 503360, 514840, 526320, 537800, 548384, 559864,</span><br><span class=\"line\"> 571344, 582824, 594304, 605784, 617264, 628744, 640224, 651704, 663184, 674664,</span><br><span class=\"line\"> 686144, 697624, 709104, 720584, 731168, 742648, 754128,</span><br><span class=\"line\">#</span><br></pre></td></tr></table></figure>\n<h3 id=\"恢复usr分区\">恢复usr分区<a title=\"#恢复usr分区\" href=\"#恢复usr分区\"></a></h3>\n<p>现在usr分区还没有格式化。我们挂载并重建usr分区，然后再将其卸载，运行 <code>fsck</code> 以确保执行正确。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># mount /dev/$name /usr</span><br><span class=\"line\"># cd /usr</span><br><span class=\"line\"># mkdir sys</span><br><span class=\"line\"># cd sys</span><br><span class=\"line\"># mt rew</span><br><span class=\"line\"># mt fsf 3</span><br><span class=\"line\"># tar xpbf 20 /dev/rmt12</span><br><span class=\"line\"># cd ..</span><br><span class=\"line\"># mt fsf</span><br><span class=\"line\"># tar xpbf 20 /dev/rmt12</span><br><span class=\"line\"># cd /</span><br><span class=\"line\"># chmod 755 / /usr /usr/sys</span><br><span class=\"line\"># rm -rf sys</span><br><span class=\"line\"># ln -s /usr/sys sys</span><br><span class=\"line\"># umount /dev/$name</span><br><span class=\"line\"># fsck /dev/r$name</span><br></pre></td></tr></table></figure>\n<p>执行结果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># chmod 755 / /usr /usr/sys</span><br><span class=\"line\"># rm -rf sys</span><br><span class=\"line\"># ln -s /usr/sys sys</span><br><span class=\"line\"># umount /dev/$name</span><br><span class=\"line\"># fsck /dev/r$name</span><br><span class=\"line\">** /dev/rra0h</span><br><span class=\"line\">** Last Mounted on /usr</span><br><span class=\"line\">** Phase 1 - Check Blocks and Sizes</span><br><span class=\"line\">** Phase 2 - Check Pathnames</span><br><span class=\"line\">** Phase 3 - Check Connectivity</span><br><span class=\"line\">** Phase 4 - Check Reference Counts</span><br><span class=\"line\">** Phase 5 - Check Cyl groups</span><br><span class=\"line\">3735 files, 25550 used, 336310 free (166 frags, 84036 blocks)</span><br><span class=\"line\">#</span><br></pre></td></tr></table></figure>\n<h3 id=\"配置fstab\">配置fstab<a title=\"#配置fstab\" href=\"#配置fstab\"></a></h3>\n<p>现在创建fstab并格式化home分区，然后我们就可以重启虚拟机、进入多用户模式了：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd /etc</span><br><span class=\"line\"># cp fstab.ra81 fstab</span><br><span class=\"line\"># newfs ra0g ra81</span><br><span class=\"line\"># sync</span><br><span class=\"line\"># reboot</span><br></pre></td></tr></table></figure>\n<p>执行结果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># cd /etc</span><br><span class=\"line\"># cp fstab.ra81 fstab</span><br><span class=\"line\"># newfs ra0g ra81</span><br><span class=\"line\">Warning: 30 sector(s) in last cylinder unallocated</span><br><span class=\"line\">/dev/rra0g:     82080 sectors in 115 cylinders of 14 tracks, 51 sectors</span><br><span class=\"line\">        42.0Mb in 8 cyl groups (16 c/g, 5.85Mb/g, 2048 i/g)</span><br><span class=\"line\">super-block backups (for fsck -b#) at:</span><br><span class=\"line\"> 32, 11512, 22992, 34472, 45952, 57432, 68912, 80392,</span><br><span class=\"line\"># sync</span><br><span class=\"line\"># reboot</span><br><span class=\"line\">syncing disks... done</span><br><span class=\"line\"></span><br><span class=\"line\">Reboot requested, PC: 80021716 (ADDL2 #8,SP)</span><br><span class=\"line\">sim&gt; q</span><br><span class=\"line\">Goodbye</span><br></pre></td></tr></table></figure>\n<h2 id=\"多用户模式！\">多用户模式！<a title=\"#多用户模式！\" href=\"#多用户模式！\"></a></h2>\n<h3 id=\"启动虚拟机-2\">启动虚拟机<a title=\"#启动虚拟机-2\" href=\"#启动虚拟机-2\"></a></h3>\n<p>再次使用 <strong>boot.ini</strong> 启动vax780.exe，我们就可以以多用户模式启动4.2 BSD了！可以使用root用户登录，默认无密码。由于系统第一次启动时会自动执行 <code>fsck</code> 指令，可能需要等待一段时间（与宿主机性能有关）。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\4.2BSD\\work&gt;vax780.exe boot.ini</span><br><span class=\"line\"></span><br><span class=\"line\">VAX780 simulator V3.8-0</span><br><span class=\"line\">loading ra(0,0)boot</span><br><span class=\"line\">Boot</span><br><span class=\"line\">: ra(0,0)vmunix</span><br><span class=\"line\">199488+56036+51360 start 0x11a0</span><br><span class=\"line\">4.2 BSD UNIX #9: Wed Nov 2 16:00:29 PST 1983</span><br><span class=\"line\">real mem  = 8384512</span><br><span class=\"line\">avail mem = 7073792</span><br><span class=\"line\">using 102 buffers containing 835584 bytes of memory</span><br><span class=\"line\">mcr0 at tr1</span><br><span class=\"line\">mcr1 at tr2</span><br><span class=\"line\">uba0 at tr3</span><br><span class=\"line\">hk0 at uba0 csr 177440 vec 210, ipl 15</span><br><span class=\"line\">rk0 at hk0 slave 0</span><br><span class=\"line\">rk1 at hk0 slave 1</span><br><span class=\"line\">uda0 at uba0 csr 172150 vec 774, ipl 15</span><br><span class=\"line\">ra0 at uda0 slave 0</span><br><span class=\"line\">ra1 at uda0 slave 1</span><br><span class=\"line\">zs0 at uba0 csr 172520 vec 224, ipl 15</span><br><span class=\"line\">ts0 at zs0 slave 0</span><br><span class=\"line\">dz0 at uba0 csr 160100 vec 300, ipl 15</span><br><span class=\"line\">dz1 at uba0 csr 160110 vec 310, ipl 15</span><br><span class=\"line\">dz2 at uba0 csr 160120 vec 320, ipl 15</span><br><span class=\"line\">dz3 at uba0 csr 160130 vec 330, ipl 15</span><br><span class=\"line\">root on ra0</span><br><span class=\"line\">WARNING: should run interleaved swap with &gt;= 2Mb</span><br><span class=\"line\">Automatic reboot in progress...</span><br><span class=\"line\">Mon Feb  6 05:21:02 PST 1984</span><br><span class=\"line\">/dev/ra0a: 326 files, 3569 used, 3860 free (20 frags, 480 blocks)</span><br><span class=\"line\">/dev/rra0h: 3735 files, 25550 used, 336310 free (166 frags, 84036 blocks)</span><br><span class=\"line\">/dev/rra0g: 2 files, 9 used, 77750 free (14 frags, 9717 blocks)</span><br><span class=\"line\">Mon Feb  6 05:21:15 PST 1984</span><br><span class=\"line\">check quotas: done.</span><br><span class=\"line\">local daemons: routed telnetd ftpd talkd syslog sendmail.</span><br><span class=\"line\">preserving editor files</span><br><span class=\"line\">clearing /tmp</span><br><span class=\"line\">standard daemons: update cron accounting mail    Mon Feb 6 05:21:17 PST 1984</span><br><span class=\"line\"></span><br><span class=\"line\"> printer.</span><br><span class=\"line\">starting network: rshd rexecd rlogind rwhod.</span><br><span class=\"line\">Mon Feb  6 05:21:18 PST 1984</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">4.2 BSD UNIX (myname)</span><br><span class=\"line\"></span><br><span class=\"line\">login:</span><br></pre></td></tr></table></figure>\n<p>现在就可以直接用root用户登录了。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">4.2 BSD UNIX (myname)</span><br><span class=\"line\"></span><br><span class=\"line\">login: root</span><br><span class=\"line\">4.2 BSD UNIX #9: Wed Nov 2 16:00:29 PST 1983</span><br><span class=\"line\"></span><br><span class=\"line\">Would you like to play a game?</span><br><span class=\"line\"></span><br><span class=\"line\">You have mail.</span><br><span class=\"line\">Don&#x27;t login as root, use su</span><br><span class=\"line\">myname#</span><br></pre></td></tr></table></figure>\n<h3 id=\"一些常用配置\">一些常用配置<a title=\"#一些常用配置\" href=\"#一些常用配置\"></a></h3>\n<h4 id=\"修改系统hostname\">修改系统hostname<a title=\"#修改系统hostname\" href=\"#修改系统hostname\"></a></h4>\n<p>安装盘中的hostname默认为myname（很怪），我们可以编辑/etc/rc.local文件修改它。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">myname# vi /etc/rc.local</span><br></pre></td></tr></table></figure>\n<p>将/bin/hostname 后的myname改为自己想要的名字（我改成了bsd），重启后即可生效。</p>\n<h4 id=\"添加用户\">添加用户<a title=\"#添加用户\" href=\"#添加用户\"></a></h4>\n<p>4.2 BSD还没有adduser指令，我们需要执行 <code>vipw</code> 指令打开密码文件手动添加。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bsd# vipw</span><br></pre></td></tr></table></figure>\n<p>打开后可以看到形如</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rogue::35:31:&amp;:/usr/guest/rogue:/bin/csh</span><br></pre></td></tr></table></figure>\n<p>的用户条目，其中各项的含义如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">用户名:加密后的用户密码（为空代表无密码）:用户代码（应与现有条目不重复）:用户组代码（10代表管理员，20代表学生？31代表访客？）:用户个人信息（可不填，显示在finger指令中）:用户启动的默认路径:用户使用的shell（留空默认是/bin/sh，也可以是/bin/csh）</span><br></pre></td></tr></table></figure>\n<p>我们在文件末尾添加新行，将新用户的信息填好（密码留空），保存退出。（建议用户路径为/usr/guest/[用户名]）</p>\n<p>然后我们创建对应的用户路径，并将其所有者改为新用户。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bsd# cd /usr/guest/</span><br><span class=\"line\">bsd# mkdir [路径名]</span><br><span class=\"line\">bsd# chown [用户名] [路径名]</span><br></pre></td></tr></table></figure>\n<p>然后重启系统，再次启动就可以用新用户登录了。</p>\n<p>登录后可以执行 <code>passwd</code> 修改当前用户密码。</p>\n<h4 id=\"修改shell配置文件\">修改shell配置文件<a title=\"#修改shell配置文件\" href=\"#修改shell配置文件\"></a></h4>\n<p>/bin/sh的配置文件为/.profile，/bin/csh的配置文件为/.cshrc。可以将用户使用的shell对应的配置文件复制到用户的启动路径里加以修改，语法和Linux类似。下面是我的/.cshrc文件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">alias mail Mail</span><br><span class=\"line\">set history=40</span><br><span class=\"line\"># directory stuff: cdpath/cd/back</span><br><span class=\"line\">set cdpath=(/a/wnj)</span><br><span class=\"line\">alias   cd      &#x27;set old=$cwd; chdir \\!*&#x27;</span><br><span class=\"line\">alias   back    &#x27;set back=$old; set old=$cwd; cd $back; unset back; dirs&#x27;</span><br><span class=\"line\"># sccs stuff: sd/co/ci/allout/out/unedit</span><br><span class=\"line\">alias   sd      &#x27;sccs get -p \\!* | diff - \\!$&#x27;</span><br><span class=\"line\">alias   co      sccs get -e</span><br><span class=\"line\">alias   ci      sccs delget</span><br><span class=\"line\">alias   allout  &quot;(cd ..; echo */SCCS/p.*|sed s/SCCS\\\\/p.//g)&quot;</span><br><span class=\"line\">alias   out     &quot;echo SCCS/p.*|sed s/SCCS\\\\/p.//g&quot;</span><br><span class=\"line\">alias   info    sccs info</span><br><span class=\"line\">alias   unedit  sccs unedit</span><br><span class=\"line\"># spms stuff: chproject/cpd</span><br><span class=\"line\">alias   chproject &#x27;eval `&quot;chproject&quot; -d \\!*`&#x27;</span><br><span class=\"line\">alias   cpd     &#x27;eval `&quot;pd&quot; \\!*`&#x27;</span><br><span class=\"line\">alias   z               suspend</span><br><span class=\"line\">alias   area    &#x27;grep \\!* /usr/games/lib/quiz.k/areas&#x27;</span><br><span class=\"line\">alias   tel     &#x27;grep -i \\!* /usr/bill/bin/telno&#x27;</span><br><span class=\"line\">alias   x       exit</span><br><span class=\"line\">alias   pd      pushd</span><br><span class=\"line\">alias   pd2     pushd +2</span><br><span class=\"line\">alias   pd3     pushd +3</span><br><span class=\"line\">alias   pd4     pushd +4</span><br><span class=\"line\">alias   j       jobs -l</span><br><span class=\"line\">alias   l       &quot;echo \\!*&#123;*&#125;&quot;</span><br><span class=\"line\">set path=(/etc /usr/ucb /bin /usr/bin /usr/local /usr/hosts . /usr/new /usr/game</span><br><span class=\"line\">s)</span><br><span class=\"line\">if ($?prompt) then</span><br><span class=\"line\">        set prompt=&quot;`hostname | sed s/ucb//`# &quot;</span><br><span class=\"line\">endif</span><br><span class=\"line\">echo &quot;Type in &#x27;rogue&#x27; to play rogue in 4.2 BSD.&quot;</span><br><span class=\"line\">echo &quot;        &#x27;rogue [savefilename].save&#x27; to load savefile.&quot;</span><br><span class=\"line\">echo &quot;__________ ________    ________ ____ ______________&quot;</span><br><span class=\"line\">echo &quot;\\______   \\\\_____  \\  /  _____/|    |   \\_   _____/&quot;</span><br><span class=\"line\">echo &quot; |       _/ /   |   \\/   \\  ___|    |   /|    __)_ &quot;</span><br><span class=\"line\">echo &quot; |    |   \\/    |    \\    \\_\\  \\    |  / |        \\&quot;</span><br><span class=\"line\">echo &quot; |____|_  /\\_______  /\\______  /______/ /_______  /&quot;</span><br><span class=\"line\">echo &quot;        \\/         \\/        \\/                 \\/ &quot;</span><br><span class=\"line\">echo &quot;&quot;</span><br><span class=\"line\">echo &quot;&quot;</span><br><span class=\"line\">echo &quot;&quot;</span><br></pre></td></tr></table></figure>\n<p>登录效果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Last login: Tue Apr 24 04:49:10 on tty00</span><br><span class=\"line\">4.2 BSD UNIX #9: Wed Nov 2 16:00:29 PST 1983</span><br><span class=\"line\"></span><br><span class=\"line\">Would you like to play a game?</span><br><span class=\"line\"></span><br><span class=\"line\">You have mail.</span><br><span class=\"line\">Type in &#x27;rogue&#x27; to play rogue in 4.2 BSD.</span><br><span class=\"line\">        &#x27;rogue [savefilename].save&#x27; to load savefile.</span><br><span class=\"line\">__________ ________    ________ ____ ______________</span><br><span class=\"line\">\\______   \\\\_____  \\  /  _____/|    |   \\_   _____/</span><br><span class=\"line\"> |       _/ /   |   \\/   \\  ___|    |   /|    __)_</span><br><span class=\"line\"> |    |   \\/    |    \\    \\_\\  \\    |  / |        \\</span><br><span class=\"line\"> |____|_  /\\_______  /\\______  /______/ /_______  /</span><br><span class=\"line\">        \\/         \\/        \\/                 \\/</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"远程用户连接\">远程用户连接<a title=\"#远程用户连接\" href=\"#远程用户连接\"></a></h3>\n<p>在 <strong>boot.ini</strong> 中添加如下内容可以使我们的虚拟机在tcp端口8888开放telnet连接，允许8个远程用户同时登入。（需要添加在启动指令之前，否则无法生效；直接添加在文件开头都行）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">set dz lines=8</span><br><span class=\"line\">set dz 7b</span><br><span class=\"line\">att dz -m 8888</span><br></pre></td></tr></table></figure>\n<p>建议使用putty或syncterm等远程连接终端。Windows自带的telnet效果非常糟糕，我使用的时候甚至不能刷新屏幕……</p>\n<h3 id=\"玩rogue！\">玩Rogue！<a title=\"#玩rogue！\" href=\"#玩rogue！\"></a></h3>\n<h4 id=\"开始新游戏\">开始新游戏<a title=\"#开始新游戏\" href=\"#开始新游戏\"></a></h4>\n<p>执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bsd# /usr/games/rogue</span><br></pre></td></tr></table></figure>\n<p>如果和我一样将 <code>/usr/games</code> 添加到配置文件中的系统路径里，只需要执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bsd# rogue</span><br></pre></td></tr></table></figure>\n<h4 id=\"从上次存档继续游戏\">从上次存档继续游戏<a title=\"#从上次存档继续游戏\" href=\"#从上次存档继续游戏\"></a></h4>\n<p>在存档文件（假设为rogue.save）所在路径执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bsd# /usr/games/rogue rogue.save</span><br></pre></td></tr></table></figure>\n<p>或</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bsd# rogue rogue.save</span><br></pre></td></tr></table></figure>\n<h4 id=\"这是rogue，它也没失踪也没怎样，只是很可爱大家都来看看.jpg\">这是Rogue，它也没失踪也没怎样，只是很可爱大家都来看看.jpg<a title=\"#这是rogue，它也没失踪也没怎样，只是很可爱大家都来看看.jpg\" href=\"#这是rogue，它也没失踪也没怎样，只是很可爱大家都来看看.jpg\"></a></h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                                   a) Some food</span><br><span class=\"line\">                                   b) +1 ring mail [protection 4] (being worn)</span><br><span class=\"line\">                                   c) A +1,+1 mace (weapon in hand)</span><br><span class=\"line\">                                   d) A +1,+0 short bow</span><br><span class=\"line\">                                   e) 33 +0,+0 arrows</span><br><span class=\"line\">                                   --Press space to continue--</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                             --------------</span><br><span class=\"line\">                             |...........*|</span><br><span class=\"line\">                             |...S........+</span><br><span class=\"line\">                             |............|</span><br><span class=\"line\">                             +......@.....|</span><br><span class=\"line\">                             |............|</span><br><span class=\"line\">                             -----+--------</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Level: 1  Gold: 0      Hp: 12(12)  Str: 16(16)  Arm: 4   Exp: 1/0</span><br></pre></td></tr></table></figure>\n","prev":{"title":"Avanor游记：从充满恶性bug的粪作中艰难通关","link":"2024/Avanor"},"next":{"title":"狄魔高根的补丁(1)","link":"2023/demogorgon_patch_1"},"plink":"http://www.ephesus.top/2023/win10_4.2_BSD/","toc":[{"id":"文件需求","title":"文件需求","index":"1"},{"id":"安装准备","title":"安装准备","index":"2","children":[{"id":"准备4.2-bsd磁带镜像（42.tap）","title":"准备4.2 BSD磁带镜像（42.tap）","index":"2.1"},{"id":"准备启动程序（boot42）","title":"准备启动程序（boot42）","index":"2.2"}]},{"id":"第一阶段","title":"第一阶段","index":"3","children":[{"id":"启动虚拟机","title":"启动虚拟机","index":"3.1"},{"id":"恢复rootdump","title":"恢复rootdump","index":"3.2"}]},{"id":"第二阶段","title":"第二阶段","index":"4","children":[{"id":"启动虚拟机-1","title":"启动虚拟机","index":"4.1"},{"id":"准备磁盘","title":"准备磁盘","index":"4.2"},{"id":"恢复usr分区","title":"恢复usr分区","index":"4.3"},{"id":"配置fstab","title":"配置fstab","index":"4.4"}]},{"id":"多用户模式！","title":"多用户模式！","index":"5","children":[{"id":"启动虚拟机-2","title":"启动虚拟机","index":"5.1"},{"id":"一些常用配置","title":"一些常用配置","index":"5.2"},{"id":"远程用户连接","title":"远程用户连接","index":"5.3"},{"id":"玩rogue！","title":"玩Rogue！","index":"5.4"}]}],"reward":true,"reading_time":"3874 words in 26 min"}