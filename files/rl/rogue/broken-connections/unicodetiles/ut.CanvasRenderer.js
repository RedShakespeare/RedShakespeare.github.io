ut.CanvasRenderer=function(t){"use strict";if(this.view=t,this.canvas=document.createElement("canvas"),!this.canvas.getContext)throw"Canvas not supported";if(this.ctx2=this.canvas.getContext("2d"),!this.ctx2||!this.ctx2.fillText)throw"Canvas not supported";t.elem.appendChild(this.canvas),this.offscreen=document.createElement("canvas"),this.ctx=this.offscreen.getContext("2d"),this.updateStyle(),this.canvas.width=(t.squarify?this.th:this.tw)*t.w,this.canvas.height=this.th*t.h,this.offscreen.width=this.canvas.width,this.offscreen.height=this.canvas.height,this.updateStyle()},ut.CanvasRenderer.prototype.updateStyle=function(t){"use strict";t=t||window.getComputedStyle(this.view.elem,null),this.ctx.font=t.fontSize+"/"+t.lineHeight+" "+t.fontFamily,this.ctx.textBaseline="middle",this.tw=this.ctx.measureText("M").width,this.th=parseInt(t.fontSize,10),this.gap=this.view.squarify?this.th-this.tw:0,this.view.squarify&&(this.tw=this.th)},ut.CanvasRenderer.prototype.clear=function(){},ut.CanvasRenderer.prototype.render=function(){"use strict";var t,e,i,s,h,a,n=this.view,c=this.view.buffer,r=n.w,l=n.h,o=.5*this.th,f=.5*this.gap;this.ctx.fillStyle=n.defaultBackground,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),a=o;for(var d=0;d<l;++d){h=0;for(var u=0;u<r;++u)e=(t=c[d][u]).ch,i=t.getColorRGB(),(s=t.getBackgroundRGB()).length&&s!==n.defaultBackground&&(this.ctx.fillStyle=s,this.ctx.fillRect(h,a-o,this.tw,this.th)),e.length&&(i.length||(i=n.defaultColor),this.ctx.fillStyle=i,this.ctx.fillText(e,h+f,a)),h+=this.tw;a+=this.th}this.ctx2.drawImage(this.offscreen,0,0)};