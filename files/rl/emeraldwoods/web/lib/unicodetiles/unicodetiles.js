window.console||(window.console={log:function(){},warn:function(){},error:function(){}});var ut=ut||{};ut.VERSION="2.1",ut.NULLCHAR=" ",ut.CSSCLASS="unicodetiles",ut.NULLTILE={},ut.Tile=function(t,i,e,r,s,n,h){"use strict";this.ch=t||ut.NULLCHAR,this.r=i,this.g=e,this.b=r,this.br=s,this.bg=n,this.bb=h},ut.Tile.prototype.getChar=function(){return this.ch},ut.Tile.prototype.setChar=function(t){this.ch=t},ut.Tile.prototype.setColor=function(t,i,e){this.r=t,this.g=i,this.b=e},ut.Tile.prototype.setGrey=function(t){this.r=t,this.g=t,this.b=t},ut.Tile.prototype.setBackground=function(t,i,e){this.br=t,this.bg=i,this.bb=e},ut.Tile.prototype.resetColor=function(){this.r=this.g=this.b=void 0},ut.Tile.prototype.resetBackground=function(){this.br=this.bg=this.bb=void 0},ut.Tile.prototype.getColorHex=function(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?"#"+this.r.toString(16)+this.g.toString(16)+this.b.toString(16):""},ut.Tile.prototype.getBackgroundHex=function(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?"#"+this.br.toString(16)+this.bg.toString(16)+this.bb.toString(16):""},ut.Tile.prototype.getColorRGB=function(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?"rgb("+this.r+","+this.g+","+this.b+")":""},ut.Tile.prototype.getBackgroundRGB=function(){return void 0!==this.br&&void 0!==this.bg&&void 0!==this.bb?"rgb("+this.br+","+this.bg+","+this.bb+")":""},ut.Tile.prototype.getColorJSON=function(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.r,g:this.g,b:this.b}:{}},ut.Tile.prototype.getBackgroundJSON=function(){return void 0!==this.r&&void 0!==this.g&&void 0!==this.b?{r:this.br,g:this.bg,b:this.bb}:{}},ut.Tile.prototype.copy=function(t){this.ch=t.ch,this.r=t.r,this.g=t.g,this.b=t.b,this.br=t.br,this.bg=t.bg,this.bb=t.bb},ut.Tile.prototype.clone=function(){return new ut.Tile(this.ch,this.r,this.g,this.b,this.br,this.bg,this.bb)},ut.NULLTILE=new ut.Tile,ut.Viewport=function(t,i,e,r,s){"use strict";this.elem=t,this.elem.innerHTML="",this.w=i,this.h=e,this.renderer=null,this.squarify=s,this.cx=Math.floor(i/2),this.cy=Math.floor(e/2),-1===t.className.indexOf(ut.CSSCLASS)&&(0===t.className.length?t.className=ut.CSSCLASS:t.className+=" "+ut.CSSCLASS),this.buffer=new Array(e);for(var n=0;n<e;++n){this.buffer[n]=new Array(i);for(var h=0;h<i;++h)this.buffer[n][h]=new ut.Tile}this.updateStyle=function(t){var i=window.getComputedStyle(this.elem,null);this.defaultColor=i.color,this.defaultBackground=i.backgroundColor,!1!==t&&this.renderer.updateStyle(i)},this.setRenderer=function(t){if(this.elem.innerHTML="","auto"===t||"webgl"===t)try{this.renderer=new ut.WebGLRenderer(this)}catch(i){console.error(i),t="canvas",this.elem.innerHTML=""}if("canvas"===t)try{this.renderer=new ut.CanvasRenderer(this)}catch(i){console.error(i),t="dom",this.elem.innerHTML=""}"dom"===t&&(this.renderer=new ut.DOMRenderer(this)),this.updateStyle(!1)},this.setRenderer(r||"auto")},ut.Viewport.prototype.getRendererString=function(){return this.renderer instanceof ut.WebGLRenderer?"webgl":this.renderer instanceof ut.CanvasRenderer?"canvas":this.renderer instanceof ut.DOMRenderer?"dom":""},ut.Viewport.prototype.put=function(t,i,e){i<0||e<0||i>=this.w||e>=this.h||(this.buffer[e][i]=t)},ut.Viewport.prototype.unsafePut=function(t,i,e){this.buffer[e][i]=t},ut.Viewport.prototype.putString=function(t,i,e,r,s,n,h,o,u){var a,c=t.length;if(!(i<0||e<0))for(var l=0;l<c;++l){if(i>=this.w&&(i=0,++e),e>=this.h)return;a=new ut.Tile(t[l],r,s,n,h,o,u),this.unsafePut(a,i,e),++i}},ut.Viewport.prototype.get=function(t,i){return t<0||i<0||t>=this.w||i>=this.h?ut.NULLTILE:this.buffer[i][t]},ut.Viewport.prototype.clear=function(){for(var t=0;t<this.h;++t)for(var i=0;i<this.w;++i)this.buffer[t][i]=ut.NULLTILE;this.renderer.clear()},ut.Viewport.prototype.render=function(){this.renderer.render()},ut.Engine=function(t,i,e,r){"use strict";this.viewport=t,this.tileFunc=i,this.w=e,this.h=r,this.refreshCache=!0,this.cacheEnabled=!1,this.transitionTimer=null,this.transitionDuration=0,this.transition=null,this.cachex=0,this.cachey=0,this.tileCache=new Array(t.h),this.tileCache2=new Array(t.h);for(var s=0;s<t.h;++s)this.tileCache[s]=new Array(t.w),this.tileCache2[s]=new Array(t.w)},ut.Engine.prototype.setTileFunc=function(t,i,e){"use strict";i&&(this.transition=void 0,"string"==typeof i&&("boxin"===i?this.transition=function(t,i,e,r,s,n,h){var o=.5*e,u=.5*r;return t-=o,i-=u,Math.abs(t)<o*h&&Math.abs(i)<u*h?s:n}:"boxout"===i?this.transition=function(t,i,e,r,s,n,h){var o=.5*e,u=.5*r;return t-=o,i-=u,h=1-h,Math.abs(t)<o*h&&Math.abs(i)<u*h?n:s}:"circlein"===i?this.transition=function(t,i,e,r,s,n,h){var o=.5*e,u=.5*r;return(t-=o)*t+(i-=u)*i<(o*o+u*u)*h?s:n}:"circleout"===i?this.transition=function(t,i,e,r,s,n,h){var o=.5*e,u=.5*r;return(t-=o)*t+(i-=u)*i>(o*o+u*u)*(h=1-h)?s:n}:"random"===i&&(this.transition=function(t,i,e,r,s,n,h){return Math.random()>h?n:s})),this.transition&&(this.transitionTimer=(new Date).getTime(),this.transitionDuration=e||500)),this.tileFunc=t},ut.Engine.prototype.setMaskFunc=function(t){this.maskFunc=t},ut.Engine.prototype.setShaderFunc=function(t){this.shaderFunc=t},ut.Engine.prototype.setWorldSize=function(t,i){this.w=t,this.h=i},ut.Engine.prototype.setCacheEnabled=function(t){this.cacheEnabled=t,this.refreshCache=!0},ut.Engine.prototype.update=function(t,i){"use strict";i=i||0;var e,r,s=(t=t||0)-this.viewport.cx,n=i-this.viewport.cy,h=(new Date).getTime();this.transition&&(e=(h-this.transitionTimer)/this.transitionDuration),e>=1&&(this.transition=void 0);for(var o=0;o<this.viewport.h;++o)for(var u=0;u<this.viewport.w;++u){var a=u+s,c=o+n;if(this.w&&(a<0||a>=this.w))r=ut.NULLTILE;else if(this.h&&(c<0||c>=this.w))r=ut.NULLTILE;else if(this.maskFunc&&!this.maskFunc(a,c))r=ut.NULLTILE;else if(this.transition&&!this.refreshCache)r=this.transition(u,o,this.viewport.w,this.viewport.h,this.tileFunc(a,c),this.tileCache[o][u],e);else if(this.cacheEnabled&&!this.refreshCache){var l=a-this.cachex,f=c-this.cachey;l>=0&&l<this.viewport.w&&f>=0&&f<this.viewport.h?(r=this.tileCache[f][l])===ut.NULLTILE&&(r=this.tileFunc(a,c)):r=this.tileFunc(a,c)}else r=this.tileFunc(a,c);this.tileCache2[o][u]=r,this.shaderFunc&&r!==ut.NULLTILE&&(r=this.shaderFunc(r,a,c,h)),this.viewport.unsafePut(r,u,o)}this.cachex=s,this.cachey=n;var b=this.tileCache;this.tileCache=this.tileCache2,this.tileCache2=b,this.refreshCache=!1};